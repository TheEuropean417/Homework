<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Infax Docket → Spreadsheet (MO-Greene)</title>
  <style>
    :root { --bg:#0b1220; --fg:#e8eef7; --muted:#a9b4c4; --accent:#6cc04a; --card:#121a2b; --border:#26324a;}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font:16px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";}
    header{padding:28px 20px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#0f172a 0%, #0c1324 100%);}
    header h1{margin:0;font-size:22px}
    header p{margin:6px 0 0;color:var(--muted)}
    main{max-width:960px;margin:0 auto;padding:24px 20px 48px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin:18px 0}
    .card h2{margin:0 0 12px;font-size:18px}
    .steps ol{margin:0;padding-left:20px}
    a.bm{display:inline-block;background:var(--accent);color:#0b120f;text-decoration:none;font-weight:700;padding:12px 16px;border-radius:10px;box-shadow:0 2px 0 rgba(0,0,0,.25);}
    a.bm:hover{filter:brightness(0.95)}
    code, pre, textarea{background:#0f172a;border:1px solid var(--border);border-radius:10px;color:var(--fg);}
    textarea{width:100%;min-height:220px;padding:12px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .muted{color:var(--muted)}
    footer{padding:18px 20px;border-top:1px solid var(--border);color:var(--muted)}
    .small{font-size:13px}
    .cta{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .pill{display:inline-block;padding:.25rem .6rem;border:1px solid var(--border);border-radius:999px;color:var(--muted);font-size:12px}
    .url{word-break:break-all}
  </style>
</head>
<body>
  <header>
    <h1>Infax Docket → Spreadsheet (MO-Greene)</h1>
    <p class="small">One-file tool that turns the <span class="url">https://infax.com/docket/MO-Greene/</span> page into a downloadable spreadsheet (CSV) via a bookmarklet.</p>
  </header>
  <main>
    <section class="card">
      <h2>Quick start</h2>
      <div class="steps">
        <ol>
          <li>Drag this button to your bookmarks bar: <a id="bm" class="bm" href="#">Infax → CSV</a></li>
          <li>Go to <strong>https://infax.com/docket/MO-Greene/</strong> and wait until the docket table is visible.</li>
          <li>Click the <em>Infax → CSV</em> bookmark. A CSV file (Excel/Sheets compatible) will download automatically.</li>
        </ol>
        <p class="muted small">Works entirely in your browser. It reads the table that’s already on the page and saves it as CSV—no servers, installs, or logins.</p>
      </div>
      <div class="cta">
        <span class="pill">Output: CSV</span>
        <span class="pill">Columns auto-detected</span>
        <span class="pill">No external services</span>
      </div>
    </section>

    <section class="card">
      <h2>Alternative: run from the browser console</h2>
      <p class="small muted">If you don’t want to use a bookmarklet, open the docket page, press <strong>F12</strong> (or <strong>Ctrl/Cmd + Shift + I</strong>) → Console, paste the script below, and press Enter.</p>
      <textarea id="console-snippet" readonly></textarea>
    </section>

    <section class="card">
      <h2>Notes</h2>
      <ul class="small muted">
        <li>Designed for pages that show columns like <em>Case Name, Case Number, Floor, Courtroom, Hearing Time, Judge</em>. The script will also try <em>Party Name</em>, <em>Start Time</em>, <em>Case Type</em>, and <em>Room</em> if present.</li>
        <li>It looks for the first visible HTML table or ARIA table/grid and exports those rows. If the page has multiple tables, scroll to make the docket table visible and run again.</li>
        <li>CSV opens in Excel, Google Sheets, Apple Numbers, LibreOffice, etc.</li>
        <li>Please follow the website’s terms of use and any applicable laws for data reuse.</li>
      </ul>
    </section>
  </main>
  <footer class="small">
    Built for exporting the Greene County (MO) docket displayed on Infax.
  </footer>

  <script>
    const CONSOLE_SNIPPET = `(function(){
  function s(t){return (t||'').replace(/\\s+/g,' ').trim()}
  function visible(el){
    try{
      const cs = getComputedStyle(el);
      if(!cs || cs.display==='none' || cs.visibility==='hidden') return false;
      if(el.offsetParent===null && cs.position!=='fixed') return false;
      return true;
    }catch(e){ return true; }
  }
  function toCSV(aoa){
    return aoa.map(r => r.map(c => {
      const x = (c==null?'':(''+c)).replace(/\\r?\\n|\\r/g,' ').replace(/\"/g,'\"\"');
      return /[\",\\t]/.test(x) ? '\"'+x+'\"' : x;
    }).join(',')).join('\\r\\n');
  }

  const wanted = ['Case Name','Party Name','Case Number','Floor','Courtroom','Hearing Time','Start Time','Case Type','Judge','Room'];

  const tables = Array.from(document.querySelectorAll('table')).filter(visible);
  let table = tables.find(t => {
    const ht = s((t.tHead && t.tHead.textContent) || (t.querySelector('thead') && t.querySelector('thead').textContent) || (t.rows[0] && t.rows[0].textContent) || '');
    return wanted.some(k => ht.includes(k));
  }) || (tables[0] || null);

  let headers = [], rows = [];
  if(table){
    const ths = table.querySelectorAll('thead th, thead td');
    if(ths.length){
      headers = Array.from(ths).map(th => s(th.textContent));
    }else{
      const fr = table.querySelector('tr');
      if(fr) headers = Array.from(fr.cells).map(c => s(c.textContent));
    }
    const bodyRows = table.querySelectorAll('tbody tr');
    const trs = bodyRows.length ? bodyRows : Array.from(table.querySelectorAll('tr')).slice(headers.length?1:0);
    rows = Array.from(trs).filter(visible).map(tr => Array.from(tr.cells).map(td => s(td.textContent)));
  }else{
    // ARIA table/grid fallback
    const aria = document.querySelector('[role=\"table\"], [role=\"grid\"]');
    if(!aria){ alert('Could not find a docket table. Scroll to the list and try again.'); return; }
    headers = Array.from(aria.querySelectorAll('[role=\"columnheader\"]')).map(c => s(c.textContent));
    rows = Array.from(aria.querySelectorAll('[role=\"row\"]'))
      .filter(r => r.querySelector('[role=\"cell\"]'))
      .map(r => Array.from(r.querySelectorAll('[role=\"cell\"]')).map(c => s(c.textContent)));
  }

  if(rows.length && headers.length && rows[0].join('|')===headers.join('|')) rows.shift();
  if(!headers.length && rows.length) headers = rows[0].map((_,i) => 'Column '+(i+1));

  const hLower = headers.map(h => h.toLowerCase());
  const idx = wanted.map(n => hLower.indexOf(n.toLowerCase())).filter(i => i>-1);
  let H = headers, R = rows;
  if(idx.length >= 3){
    H = idx.map(i => headers[i]);
    R = rows.map(r => idx.map(i => r[i] || ''));
  }

  const data = [H].concat(R);
  const blob = new Blob([toCSV(data)], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  const date = (new Date()).toISOString().slice(0,10);
  const title = (document.querySelector('h1,h2') && s(document.querySelector('h1,h2').textContent)) || (document.title || 'MO-Greene Docket');
  a.href = URL.createObjectURL(blob);
  a.download = title.replace(/[^A-Za-z0-9]+/g,' ').trim() + ' ' + date + '.csv';
  document.body.appendChild(a);
  a.click();
  setTimeout(() => { URL.revokeObjectURL(a.href); a.remove(); }, 1000);
})();`;

    // Put pretty code into the textarea
    document.getElementById('console-snippet').value = CONSOLE_SNIPPET;

    // Generate a robust bookmarklet from the pretty code
    const bmCode = CONSOLE_SNIPPET
      .replace(/\\n/g, ' ')               // newlines -> spaces
      .replace(/\\s{2,}/g, ' ')           // collapse multiple spaces
      .replace(/\\s*([{}();,:])\\s*/g, '$1'); // trim around punctuation (simple/minimal)
    document.getElementById('bm').setAttribute('href', 'javascript:' + bmCode);
  </script>
</body>
</html>
